<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <title>A Metade Que Me Faltava</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Garamond&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>

<body>

    <!-- Header fixo -->
    <header id="main-header">
        <button id="menu-btn" class="header-btn" aria-label="Abrir índice">
            <span class="material-icons-round">menu</span>
        </button>

        <div class="book-title" id="chapter-title">Carregando...</div>

        <button id="settings-btn" class="header-btn" aria-label="Configurações">
            <span class="material-icons-round">settings</span>
        </button>
        <!-- Language selector -->
        <select id="language-select" class="header-btn" aria-label="Selecionar idioma" style="margin-left:8px;">
            <option value="pt" selected>PT</option>
            <option value="en">EN</option>
            <option value="es">ES</option>
            <option value="fr">FR</option>
        </select>
    </header>

    <!-- Overlay -->
    <div id="overlay"></div>

    <!-- Sidebar -->
    <aside id="sidebar">
        <button id="close-sidebar" class="close-sidebar">×</button>
        <h3>Índice</h3>
        <ul id="chapter-list" class="chapter-list"></ul>
    </aside>

    <!-- Área Principal (Scroll) -->
    <main id="reader-container">
        <article id="content">
            <p style="text-align:center; margin-top: 50vh;">Carregando...</p>
        </article>
    </main>

    <!-- Footer -->
    <footer>
        <div id="status-stats"
            style="flex:2; font-size: 10px; opacity: 0.7; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; padding-left: 10px;">
            ...</div>
        <div id="status-page" class="page-status" style="flex:1; text-align: right; padding-right: 10px;">0%</div>
    </footer>

    <!-- Modal Configurações -->
    <div id="settings-modal">

        <div class="setting-group">
            <span class="setting-label">Tema</span>
            <div class="theme-options">
                <button class="theme-btn" data-theme="light"><span class="material-icons-round">light_mode</span>
                    Claro</button>
                <button class="theme-btn" data-theme="sepia"><span class="material-icons-round">menu_book</span>
                    Sépia</button>
                <button class="theme-btn" data-theme="dark"><span class="material-icons-round">dark_mode</span>
                    Escuro</button>
            </div>
        </div>

        <div class="setting-group">
            <div style="display:flex; justify-content:space-between;">
                <span class="setting-label">Tamanho da Fonte</span>
                <span id="font-val" style="font-size:0.8rem;">18px</span>
            </div>
            <input type="range" id="font-size-range" min="14" max="24" step="1" value="18">
        </div>

        <div class="setting-group">
            <span class="setting-label">Tipo de Letra</span>
            <select id="font-family-select"
                style="width:100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; background: transparent; color: var(--text-color);">
                <option value="serif">Com Serifa (Clássica)</option>
                <option value="sans">Sem Serifa (Moderna)</option>
            </select>
        </div>
    </div>

    <!-- Modal Editor -->
    <div id="editor-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:2000; background:rgba(0,0,0,0.9); flex-direction:column; padding:20px; box-sizing:border-box;">
        <div
            style="flex:1; display:flex; flex-direction:column; max-width:800px; margin:0 auto; width:100%; background:var(--bg-color); border-radius:8px; overflow:hidden;">
            <div
                style="padding:10px; border-bottom:1px solid #ccc; display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0;">Editar Capítulo</h3>
                <button id="close-editor"
                    style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <textarea id="editor-textarea"
                style="flex:1; width:100%; padding:15px; border:none; resize:none; font-family:monospace; font-size:1rem; line-height:1.5; background:var(--bg-color); color:var(--text-color); box-sizing:border-box;"></textarea>
            <div style="padding:10px; border-top:1px solid #ccc; display:flex; justify-content:flex-end; gap:10px;">
                <span id="editor-status" style="align-self:center; font-size:0.8rem; margin-right:auto;"></span>
                <button id="btn-cancel-edit"
                    style="padding:8px 16px; border:1px solid #ccc; background:transparent; border-radius:4px; cursor:pointer; color:var(--text-color);">Cancelar</button>
                <button id="btn-save-edit"
                    style="padding:8px 16px; border:none; background:var(--accent-color, #007bff); color:white; border-radius:4px; cursor:pointer; font-weight:bold;">Salvar
                    Alterações</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/marked.min.js"></script>
    <script>
        // Load correct book content based on language selection, then load app
        (function () {
            const version = new Date().getTime(); // Cache buster
            const savedLang = localStorage.getItem('selectedLanguage') || 'pt';
            const contentScript = document.createElement('script');
            contentScript.src = `js/book-content-${savedLang}.js?v=${version}`;

            contentScript.onerror = function () {
                // Fallback to Portuguese if language file doesn't exist
                console.warn(`Language file for ${savedLang} not found, using Portuguese`);
                const fallbackScript = document.createElement('script');
                fallbackScript.src = `js/book-content-pt.js?v=${version}`;
                fallbackScript.onload = function () {
                    loadAppScript();
                };
                document.head.appendChild(fallbackScript);
            };

            contentScript.onload = function () {
                loadAppScript();
            };

            document.head.appendChild(contentScript);

            function loadAppScript() {
                const appScript = document.createElement('script');
                appScript.src = `js/app.js?v=${version}`;
                document.body.appendChild(appScript);
            }
        })();
    </script>
    <script>
        // Initialize language selector after DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            const langSelect = document.getElementById('language-select');
            const savedLang = localStorage.getItem('selectedLanguage') || 'pt';
            langSelect.value = savedLang;
            langSelect.addEventListener('change', function () {
                localStorage.setItem('selectedLanguage', this.value);
                // Reload to apply language change
                location.reload();
            });
        });
    </script>

</body>

</html>